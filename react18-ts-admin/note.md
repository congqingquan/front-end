# 路由设计

## 路由中的登陆鉴权
1. 使用路由守卫，实现拦截通过链接直接访问特定页面（存在无法检测出 token 状态的问题）
    1. 若没有 token，强行跳转到登录页 / 若没有 token，跳转到 401 页，并在 401 页提供去登陆按钮
2. axios 的响应拦截器中，判断接口的 HTTP 状态码是否为 401，是则进行 1.1 的逻辑（弥补第一步中的缺陷：只能校验 token 是否存在，但无法实时判断 token 在服务器的状态）

## 路由中的菜单资源鉴权
1. 使用路由守卫，实现拦截通过链接直接访问特定页面 (存在无法检测出资源的权限状态问题)
    1. 如果路由表的数据由后端接口动态返回，则肯定不存在没有权限的页面路由，则无需在路由守卫中处理
    2. 如果路由表是前端写死，那么就需要在路由守卫中，使用后端接口返回的有权限的资源数据列表（但是数据状态可能已更新），对比是否包含即将要访问的菜单资源。若无，则跳转到 403 页
2. axios 的响应拦截器中，判断接口的 HTTP 状态码是否为 403，是则进行 1.1 / 1.2 的逻辑（弥补第一步中的缺陷：无法实时判断用户拥有的菜单资源在服务器的状态 -> 禁用 or 已无权）

## 方案
1. 不使用路由守卫，完全依赖后端接口：只需要在 axios 中添加请求、响应拦截器即可（根据接口的状态码，跳到不同的处理页），无需使用路由守卫
2. 使用路由守卫，前后端皆校验：在第一步的基础之上，同时使用路由守卫，提前进行登陆、权限的检查

## 路由守卫方案的好处与坏处

1. 好处：使用路由守卫可以在调用接口前进行预检查，节省了服务器资源
2. 坏处：使用的数据的状态不是最新的

所以总的来看，仍必须以后端接口的响应状态为准。

## 最佳方案

1. 路由表：动态配置，根据后端接口的返回结果动态渲染。
    1. 路由表本质上就是菜单管理中配置的菜单树数据
    2. 401、403、404、登陆 等这样的非菜单项路由，需要前端手动写死
2. 登陆、菜单资源鉴权：完全依赖后端接口，并在 axios 设置请求、响应拦截器。好处：
    1. 实时检查资源的权限状态
    2. 前端无需编写额外的代码，如路由守卫

## 动态路由

动态路由的本质就是菜单资源数据。根据菜单资源数据转为路由数据，并通过懒加载的方式，动态加载路由项上的 page 组件。

# 401、403、404 页面

1. 如果基于未登陆则跳转到登陆页的策略，则无需前端编写 401 页面组件
2. 如果基于访问不存在的页面则跳转到首页的策略，则无需前端编写 404 页面组件
3. 没有想到比较好的平替策略，前端跳转到 403 页面组件即可

